<?xml version="1.0" encoding="UTF-8"?>
<definitions id="definitions" targetNamespace="http://activiti.org/bpmn20" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:activiti="http://activiti.org/bpmn" xmlns="http://www.omg.org/spec/BPMN/20100524/MODEL" xsi:schemaLocation="http://www.springframework.org/schema/beans   http://www.springframework.org/schema/beans/spring-beans.xsd">

	<process id="demoprocess" name="Demo Process">
		<startEvent id="theStart" activiti:candidateGroups="DEVELOPER" activiti:formKey="Start.form">
			<documentation>
				The start event requires a filled form.
			</documentation>
			<extensionElements>
				<activiti:formProperty id="title" name="Issue Title" variable="title" type="string" required="true" />
				<activiti:formProperty id="description" name="Issue Description" variable="description" type="string" required="true" />
				<activiti:formProperty id="userId" name="ID of the user starting the process" variable="userIdOfStartingUser" type="string" required="true" />
			</extensionElements>
		</startEvent>

		<sequenceFlow id="flow" sourceRef="theStart" targetRef="review" />

		<userTask id="review" activiti:candidateGroups="DEVELOPER" activiti:formKey="Review.form">
			<documentation>
				Somebody has to review the newly created issue to verify it's validity.
			</documentation>
			<extensionElements>
                <activiti:formProperty id="title" variable="title" writable="false" />
                <activiti:formProperty id="approve" type="boolean" variable="accepted" required="true"/>
                <activiti:formProperty id="justification" type="string" variable="accepted" required="true"/>
			</extensionElements>
		</userTask>

		<sequenceFlow sourceRef="review" targetRef="exclusiveGateway" />

		<exclusiveGateway id="exclusiveGateway" />

		<sequenceFlow id="flow1_gateway1" sourceRef="exclusiveGateway" targetRef="theEnd">
			<documentation>
				Flow taken if the issue has been rejected.
			</documentation>
			<conditionExpression xsi:type="tFormalExpression">
    			<![CDATA[${!accepted}]]>
			</conditionExpression>
		</sequenceFlow>

		<sequenceFlow id="flow2_gateway1" sourceRef="exclusiveGateway" targetRef="theEnd">
			<documentation>
				Flow taken if the issue has been accepted.
			</documentation>
			<conditionExpression xsi:type="tFormalExpression">
    			<![CDATA[${accepted}]]>
			</conditionExpression>
		</sequenceFlow>

		<endEvent id="theEnd" />

	</process>

</definitions>